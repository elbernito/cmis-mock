<!-- src/main/resources/templates/documents.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: headerHead}"></head>
<body>
<div th:replace="~{fragments/header :: headerNav}"></div>

<div class="container">
    <div class="card mt-4">
        <div class="card-header">Documents</div>
        <div class="card-content">
            <p style="color:#666; margin-bottom:24px;">
                Manage your CMIS documents hierarchy: create, view, edit and delete folders.
            </p>

            <!-- Upload Form -->
            <div class="form-row" style="align-items:center;">
                <form th:action="@{/documents}"
                      th:if="${editId == null}"
                      method="post"
                      enctype="multipart/form-data"
                      style="display:flex; width:100%; align-items:center;">
                    <!-- Custom file input -->
                    <div style="display:flex; align-items:center; flex:1;">
                        <input
                                type="file"
                                id="fileInput"
                                name="file"
                                hidden
                                onchange="updateFileName(this)" />
                        <label for="fileInput" class="btn"
                               style="font-size:0.735em; padding:5.25px 8.4px;">
                            Choose File
                        </label>
                        <span id="fileName" style="margin-left:8px; color:#333;">
                  No file chosen
                </span>
                    </div>
                    <!-- Upload button aligned right -->
                    <div style="margin-left:auto;">
                        <button class="btn" style="font-size:0.735em; padding:5.25px 8.4px;">
                            Upload
                        </button>
                    </div>
                </form>

                <!-- Update Form -->
                <form th:action="@{/documents/{id}(id=${editId})}"
                      th:if="${editId != null}"
                      method="post"
                      enctype="multipart/form-data"
                      style="display:flex; width:100%; align-items:center; margin-top:16px;">
                    <div style="display:flex; align-items:center; flex:1;">
                        <input
                                type="file"
                                id="fileInputUpdate"
                                name="file"
                                hidden
                                onchange="updateFileName(this, 'fileNameUpdate')" />
                        <label for="fileInputUpdate" class="btn"
                               style="font-size:0.735em; padding:5.25px 8.4px;">
                            Choose File
                        </label>
                        <span id="fileNameUpdate" style="margin-left:8px; color:#333;">
                  No file chosen
                </span>
                    </div>
                    <div style="margin-left:auto;">
                        <button class="btn" style="font-size:0.735em; padding:5.25px 8.4px;">
                            Update
                        </button>
                    </div>
                </form>
            </div>

            <div class="my-5"></div>

            <!-- Documents Table -->
            <div class="table-container">
                <table>
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Mime Type</th>
                        <th>Created At</th>
                        <th>Updated At</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="doc : ${documents}">
                        <td th:text="${doc.id}"></td>
                        <td th:text="${doc.name}"></td>
                        <td th:text="${doc.mimeType}"></td>
                        <td th:text="${#dates.format(doc.createdAt,'yyyy-MM-dd HH:mm')}"></td>
                        <td th:text="${#dates.format(doc.updatedAt,'yyyy-MM-dd HH:mm')}"></td>
                        <td class="actions">
                            <a th:href="@{/documents/{id}/content(id=${doc.id})}"
                               class="btn" style="font-size:0.735em; padding:5.25px 8.4px;">
                                Download
                            </a>
                            <a th:href="@{/documents/edit/{id}(id=${doc.id})}"
                               class="btn" style="font-size:0.735em; padding:5.25px 8.4px;">
                                Edit
                            </a>
                            <a th:href="@{/documents/delete/{id}(id=${doc.id})}"
                               class="btn" style="font-size:0.735em; padding:5.25px 8.4px;">
                                Delete
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Script to update filename display -->
<script>
    function updateFileName(input, spanId = 'fileName') {
        const fileName = input.files && input.files.length > 0
            ? input.files[0].name
            : 'No file chosen';
        document.getElementById(spanId).textContent = fileName;
    }
</script>

<!-- Material Icons Font -->
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
</body>
</html>